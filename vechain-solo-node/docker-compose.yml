version: '3'

# -----------------------------------------------------------------------------
# WHY I AM USING THIS:
#
# 1. My Simulation (Hardhat/Ethers.js) speaks "JSON-RPC". It tries to talk to
#    the blockchain on port 8545 using standard Ethereum commands.
#
# 2. The VeChain Node (thor) speaks "REST API". It listens on port 8669 and
#    does not understand Ethereum commands.
#
# 3. If I connect Hardhat directly to port 8669, it fails immediately.
#
# 4. SOLUTION: I run 'web3-gear' as a middleman. It sits on port 8545,
#    catches my Hardhat commands, translates them into VeChain REST calls,
#    and forwards them to the node.
#
# 5. use --- docker-compose up --- to run the node
# -----------------------------------------------------------------------------

services:
  # The VeChain Node (The actual blockchain)
  thor:
    image: vechain/thor:latest
    container_name: vechain-solo
    # --api-cors '*' is crucial to allow the proxy to talk to it
    command: solo --api-cors '*' --api-addr 0.0.0.0:8669 --persist
    ports:
      - "8669:8669"

  # The Proxy (The Translator)
  web3-gear:
    image: vechain/web3-gear
    container_name: vechain-proxy
    # Connects to 'thor' on 8669, exposes '8545' for Hardhat
    command: --endpoint http://thor:8669 --port 8545 --host 0.0.0.0
    ports:
      - "8545:8545" # Ethereum Standard Port (JSON-RPC)
    depends_on:
      - thor